import{r as a}from"./react-vendor-5RRwqQhZ.js";const S="npm_packages_vaporjawn_v1",T=1e3*60*60*12;async function $(c){try{const e=await fetch(`https://api.npmjs.org/downloads/point/last-week/${encodeURIComponent(c)}`);if(!e.ok)return;const s=await e.json();if(typeof s.downloads=="number")return s.downloads}catch{}}function F(c){var s,i,l;const e=c.package;return{name:e.name,version:e.version,description:e.description||"",publishedAt:e.date,homepage:(s=e.links)==null?void 0:s.homepage,repository:(i=e.links)==null?void 0:i.repository,npmUrl:(l=e.links)==null?void 0:l.npm,keywords:e.keywords||[]}}function I(c={}){const{maintainer:e="vaporjawn",size:s=20,cacheTtlMs:i=T,fetchDownloads:l=!0}=c,[D,w]=a.useState([]),[j,y]=a.useState(!1),[E,f]=a.useState(null),h=a.useRef(!1),p=`${S}_${e}_${s}`,g=a.useCallback(()=>{try{const t=localStorage.getItem(p);if(!t)return null;const n=JSON.parse(t);return!n.fetchedAt||!Array.isArray(n.data)?null:n}catch{return null}},[p]),k=a.useCallback(t=>{try{const n={fetchedAt:Date.now(),data:t};localStorage.setItem(p,JSON.stringify(n))}catch{}},[p]),b=a.useCallback(async t=>{if(!l)return t;const n=t.slice(0,10),d=await Promise.all(n.map(async o=>{const m=await $(o.name);return{...o,weeklyDownloads:m}}));return t.map(o=>d.find(r=>r.name===o.name)||o)},[l]),u=a.useCallback(async(t=!1)=>{if(!h.current){h.current=!0,y(!0),f(null);try{const n=`https://registry.npmjs.org/-/v1/search?text=maintainer:${encodeURIComponent(e)}&size=${s}`,d=await fetch(n);if(!d.ok)throw new Error(`npm search failed (${d.status})`);let r=((await d.json()).objects||[]).map(F);r.sort((A,C)=>{const _=A.publishedAt?new Date(A.publishedAt).getTime():0;return(C.publishedAt?new Date(C.publishedAt).getTime():0)-_}),r=await b(r),w(r),k(r)}catch(n){t||(n instanceof Error?f(n.message):f("Failed to load npm packages"))}finally{y(!1),h.current=!1}}},[e,s,b,k]);a.useEffect(()=>{const t=g();if(t){const n=Date.now()-t.fetchedAt<i;w(t.data),n||u()}else u()},[i,g,u]);const v=a.useCallback(()=>{u(!0)},[u]);return{packages:D,loading:j,error:E,refresh:v}}export{I as u};
//# sourceMappingURL=useNpmPackages-ZpJnfk8S.js.map
