import{r as a}from"./vendor-gvDtyKy-.js";const S="npm_packages_vaporjawn_v1",T=1e3*60*60*12;async function $(c){try{const e=await fetch(`https://api.npmjs.org/downloads/point/last-week/${encodeURIComponent(c)}`);if(!e.ok)return;const r=await e.json();if(typeof r.downloads=="number")return r.downloads}catch{}}function F(c){const e=c.package;return{name:e.name,version:e.version,description:e.description||"",publishedAt:e.date,homepage:e.links?.homepage,repository:e.links?.repository,npmUrl:e.links?.npm,keywords:e.keywords||[]}}function I(c={}){const{maintainer:e="vaporjawn",size:r=20,cacheTtlMs:h=T,fetchDownloads:m=!0}=c,[D,w]=a.useState([]),[j,y]=a.useState(!1),[E,d]=a.useState(null),p=a.useRef(!1),u=`${S}_${e}_${r}`,g=a.useCallback(()=>{try{const t=localStorage.getItem(u);if(!t)return null;const n=JSON.parse(t);return!n.fetchedAt||!Array.isArray(n.data)?null:n}catch{return null}},[u]),k=a.useCallback(t=>{try{const n={fetchedAt:Date.now(),data:t};localStorage.setItem(u,JSON.stringify(n))}catch{}},[u]),b=a.useCallback(async t=>{if(!m)return t;const n=t.slice(0,10),l=await Promise.all(n.map(async o=>{const f=await $(o.name);return{...o,weeklyDownloads:f}}));return t.map(o=>l.find(s=>s.name===o.name)||o)},[m]),i=a.useCallback(async(t=!1)=>{if(!p.current){p.current=!0,y(!0),d(null);try{const n=`https://registry.npmjs.org/-/v1/search?text=maintainer:${encodeURIComponent(e)}&size=${r}`,l=await fetch(n);if(!l.ok)throw new Error(`npm search failed (${l.status})`);let s=((await l.json()).objects||[]).map(F);s.sort((A,C)=>{const _=A.publishedAt?new Date(A.publishedAt).getTime():0;return(C.publishedAt?new Date(C.publishedAt).getTime():0)-_}),s=await b(s),w(s),k(s)}catch(n){t||(n instanceof Error?d(n.message):d("Failed to load npm packages"))}finally{y(!1),p.current=!1}}},[e,r,b,k]);a.useEffect(()=>{const t=g();if(t){const n=Date.now()-t.fetchedAt<h;w(t.data),n||i()}else i()},[h,g,i]);const v=a.useCallback(()=>{i(!0)},[i]);return{packages:D,loading:j,error:E,refresh:v}}export{I as u};
